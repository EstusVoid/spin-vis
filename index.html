<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta charset="UTF-8">
    <title>Spin | Visualisation</title>

    <link rel="stylesheet" href="css/style.min.css">
    <link rel="stylesheet" href="css/jquery-ui.css">

    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="js/src/FileSaver.js"></script>
    <script src="js/src/simulate.js"></script>
    <!-- <script src="js/src/download.js"></script> -->
    <script src="js/webglspins.min.js"></script>
    <!-- DEMO WEBGLSPINS: https://github.com/FlorianRhiem/WebGLSpins.js/blob/master/examples/demo.html -->

</head>

<body>
    <main>

        <header>
            <div class="name">
                Spin <span> Visualisation </span>
            </div>
        </header>
        <div class="grid">

            <section class="spin-grid">
                <div class="spin-grid__visible  resizable">
                    <!-- SPIN VISUALISATION -->

                    <canvas id="webgl-canvas"></canvas>


                </div>

                <div class="sidebar-grid__import   resizable">
                    <!-- import data -->
                    <div class="__content">
                        <div class="__content">

                            <form name="sci-calc">
                                <div class="sci-calc-input">
                                       <input id="display" name="display" maxlength="25" value="0.00" disabled/>
                                    <div id="value"></div>
                                </div>
                                <div class="sci-calc-btn">
                                    <div class="__head">Расчитать</div>
                                    <div class="__body col-2">
                                        <button type="button" class="btn" title="Энергия системы" onclick="simulateObject.energy(form); changeValue('E =')">Энергия системы</button>
                                        <button type="button" class="btn" title="Намагниченность" onclick="simulateObject.magnetization(form); changeValue('M =')" >Намагниченность</button>
                                    </div>
                                </div>
                                <div class="sci-calc-btn">
                                    <div class="__head">Сгенерировать модель</div>
                                    <div class="__body col-4">
                                        <button type="button" class="btn" title="Скирмион" onclick="simulateObject.skyrmion_create(); getNewValue(form)">S</button>
                                        <button type="button" class="btn" title="Ферромагнетик" onclick="simulateObject.ferromagnetic_create(); getNewValue(form)">F</button>
                                        <button type="button" class="btn" title="Cлучайная модель Изинга" onclick="simulateObject.randomspinIzing_create(); getNewValue(form)">R-I</button>
                                        <button type="button" class="btn" title="Cлучайная модель" onclick="simulateObject.randomspin_create(); getNewValue(form)">R</button>
                                    </div>
                                </div>
                                <div class="sci-calc-btn">
                                    <div class="__head">Инструменты</div>
                                    <div class="__body col-2">
                                        <button type="button" class="btn" title="Cлучайная модель Изинга" onclick="simulateObject.simulateNew(400); this.form.display.value='0.00'; changeValue('')">Сбросить</button>
                                        <button type="button" class="btn" title="Cлучайная модель" onclick="simulateObject.default_camera()">Камера по-умолчанию</button>
                                    </div>
                                </div>
                            </form>
                    </div>
                </div>
                </div>

                <div class="sidebar-grid__toolbar">
                    <!-- toolbar -->
                    <p>
                        <p>
                            <input type="file" id="file-positions" accept=".txt"> Позиции
                        </p>
                        <p>
                            <input type="file" id="file-directions" accept=".txt"> Направления
                        </p>
                        <button type="button" onclick="simulateObject.downloadFile();">Сохранить</button>
                        <button type="button" onclick="simulateObject.simulateByData();">Отобразить</button>
                        <button type="button" onclick="simulateObject.simulateNew(400);">Сбросить</button>
                    </p>
                </div>
            </section>

        </div>

    </main>
    <script type='text/javascript'>
        $(document).ready(function() {
            simulateObject.simulateNew(400);
            const filePositions = document.getElementById('file-positions');
            const fileDirections = document.getElementById('file-directions');
            filePositions.addEventListener('change', (event) => {
                const file = event.target.files[0];
                const reader = new FileReader();
                reader.addEventListener('load', (event) => {
                    let text = event.target.result;
                    let result = text.split `,`.map(x => +x);
                    simulateObject.spinPositions = result;
                });
                reader.readAsText(file);
            });

            fileDirections.addEventListener('change', (event) => {
                const file = event.target.files[0];
                const reader = new FileReader();
                reader.addEventListener('load', (event) => {
                    let text = event.target.result;
                    let result = text.split `,`.map(x => +x);
                    simulateObject.spinDirections = result;
                });
                reader.readAsText(file);
            });
        });

        function changeValue(value) {
            document.getElementById('value').innerText=value;
        }

        function getNewValue(e) {
            form = e;
            value = document.getElementById('value').innerText;
            if (value == "E =") simulateObject.energy(form);
            if (value == "M =")  simulateObject.magnetization(form);
        }
    </script>
    <script src="js/frontend.min.js"></script>
</body>

</html>